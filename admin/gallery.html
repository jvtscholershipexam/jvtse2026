<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin – Gallery Upload | 2026 Jai Veer Tejaji Club</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      background:#032015;
      margin:0;
      color:#fff;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      background:rgba(0,0,0,0.7);
      padding: 15px;
      border-radius:10px;
      box-shadow:0 0 12px #000;
      border:1px solid rgba(255,255,255,0.15);
    }
    h1 { margin-top:0; color:#ffd65a; }
    label { display:block; margin-top:8px; font-size:14px; }
    input[type="text"] {
      width:100%; padding:7px; border-radius:6px; border:none; margin-top:3px;
    }
    input[type="file"] { margin-top:5px; color:#fff; }
    button {
      margin-top:12px; padding:8px 16px; border:none; border-radius:999px;
      background:#d4af37; color:#000; font-size:14px; font-weight:bold;
      cursor:pointer;
    }
    button:disabled { opacity:0.6; cursor:not-allowed; }
    .msg { margin-top:8px; font-size:13px; }
    .preview-list {
      margin-top:15px; display:flex; flex-wrap:wrap; gap:10px;
    }
    .preview-item {
      width:140px; text-align:center; font-size:12px;
      border:1px solid rgba(255,255,255,0.2);
      border-radius:8px; padding:6px; background:#001c12;
    }
    .preview-item img {
      width:110px; height:110px; object-fit:cover;
      border-radius:6px; border:1px solid #d4af37;
    }
    .btn-small {
      margin-top:6px; padding:4px 8px; font-size:11px;
      border-radius:6px; border:none; cursor:pointer;
    }
    .btn-delete { background:#c62828; color:#fff; }
    .topbar-links a {
      margin-right:8px; font-size:13px; text-decoration:none; color:#ffd65a;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.48.0/dist/umd/supabase.min.js"></script>
</head>
<body>

<div class="container">
  <div class="topbar-links">
    <a href="dashboard.html">← Admin Home</a> |
    <a href="../gallery.html" target="_blank">View Gallery</a>
  </div>

  <h1>Gallery Photo Upload</h1>

  <label>Select Image File</label>
  <input type="file" id="photoFile" accept="image/*">

  <label>Caption (optional)</label>
  <input type="text" id="captionInput">

  <label>
    <input type="checkbox" id="visibleCheck" checked> Visible in Gallery
  </label>

  <button id="uploadBtn">Upload to Gallery</button>
  <p class="msg" id="msgBox"></p>

  <h3 style="color:#ffd65a">Latest Uploaded Photos</h3>
  <div id="previewList" class="preview-list"></div>
</div>

<script>
  if (localStorage.getItem("bdsAdminLoggedIn") !== "yes") {
    window.location.href = "login.html";
  }

  const supabase = window.supabase.createClient(
    "https://iqcbgiwycbuyvpxegmfg.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxY2JnaXd5Y2J1eXZweGVnbWZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5NDQ4MDYsImV4cCI6MjA4MzUyMDgwNn0.WfFbOZw2ZRRX9bWxQ0HMUqskAfIL4MvoyAENFPPatjM"
  );

  const BUCKET = "gallery";

  uploadBtn.onclick = async () => {
    const file = photoFile.files[0];
    if(!file) return msgBox.innerText="Select image";

    uploadBtn.disabled=true;
    msgBox.innerText="Uploading...";

    const path = `gallery/${Date.now()}_${file.name}`;
    const up = await supabase.storage.from(BUCKET).upload(path,file);
    if(up.error){ msgBox.innerText=up.error.message; return; }

    const pub = supabase.storage.from(BUCKET).getPublicUrl(path).data.publicUrl;

    await supabase.from("gallery_items").insert({
      file_path:path,
      public_url:pub,
      caption:captionInput.value||null,
      visible:visibleCheck.checked
    });

    msgBox.innerText="Uploaded successfully";
    photoFile.value=""; captionInput.value="";
    load();
    uploadBtn.disabled=false;
  };

  async function load(){
    const {data}=await supabase.from("gallery_items")
      .select("*").order("created_at",{ascending:false}).limit(12);
    previewList.innerHTML="";
    data.forEach(r=>{
      previewList.innerHTML+=`
        <div class="preview-item">
          <img src="${r.public_url}">
          <div>${r.caption||""}</div>
          <button class="btn-small btn-delete"
            onclick="del(${r.id},'${r.file_path}')">Delete</button>
        </div>`;
    });
  }

  async function del(id,path){
    if(!confirm("Delete permanently?")) return;
    await supabase.storage.from(BUCKET).remove([path]);
    await supabase.from("gallery_items").delete().eq("id",id);
    load();
  }

  load();
</script>

</body>
</html>

