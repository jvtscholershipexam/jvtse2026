<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin – Student Applications | 2026 Jai Veer Tejaji Club</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:Arial;
  background:#f6fff7;
  margin:0
}
.container{
  max-width:1200px;
  margin:15px auto;
  background:#ffffff;
  padding:15px;
  border-radius:10px;
  border:2px solid #0b4d2b
}
h1{
  color:#0b4d2b;
  margin-bottom:10px
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px
}
th,td{
  border:1px solid #cfded2;
  padding:6px;
  text-align:left
}
th{
  background:#e8f5ec
}
button{
  padding:5px 8px;
  border:none;
  border-radius:4px;
  cursor:pointer;
  font-size:12px
}
.view{background:#1976d2;color:#fff}
.del{background:#c62828;color:#fff}
.edit{background:#6a1b9a;color:#fff}
.approve{background:#2e7d32;color:#fff}
.pending{background:#ffa000}
.reject{background:#c62828;color:#fff}
.section{
  margin-top:12px;
  border-top:1px solid #cfded2;
  padding-top:8px
}
label{font-size:13px}
input{
  width:100%;
  padding:5px;
  margin-top:2px
}
.msg{
  font-size:13px;
  margin-top:6px
}
a{
  color:#0b4d2b;
  font-weight:bold;
  text-decoration:none
}
</style>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body>
<div class="container">

<a href="dashboard.html">← Admin Home</a>
<h1>Student Applications – 2026 Jai Veer Tejaji Club</h1>

<button onclick="downloadExcel()">⬇ Download Excel</button>
<p id="listMsg">Loading...</p>

<table>
<thead>
<tr>
<th>#</th>
<th>Roll</th>
<th>Name</th>
<th>Mobile</th>
<th>Exam Level</th>
<th>Form</th>
<th>Payment</th>
<th>Action</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<!-- DETAIL BOX -->
<div id="detailBox" style="display:none">

<div class="section">
<b>Name:</b> <span id="dName"></span><br>
<b>Father:</b> <span id="dFather"></span><br>
<b>Mobile:</b> <span id="dMobile"></span><br>
<b>Roll:</b> <span id="dRoll"></span><br>
<b>Exam Level:</b> <span id="dLevel"></span><br>
<b>Form Status:</b> <span id="dStatus"></span><br>
<b>Payment:</b> <span id="dPayment"></span>
</div>

<div class="section">
<b>Documents</b><br>
Photo: <a id="dPhoto" target="_blank">Not uploaded</a><br>
Aadhaar Front: <a id="dAF" target="_blank">Not uploaded</a><br>
Aadhaar Back: <a id="dAB" target="_blank">Not uploaded</a><br>
Marksheet: <a id="dMS" target="_blank">Not uploaded</a><br>
Payment Screenshot: <a id="dPSS" target="_blank">Not uploaded</a>
</div>

<div class="section">
<button class="approve" onclick="setStatus('approved',true)">Approve</button>
<button class="pending" onclick="setStatus('pending',false)">Pending</button>
<button class="reject" onclick="setStatus('rejected',false)">Reject</button>
</div>

<div class="section">
<b>Admit Card</b>
<label>Centre</label><input id="cCentre">
<label>Date</label><input id="cDate">
<label>Shift</label><input id="cShift">
<label>Start Time</label><input id="cStart">
<label>End Time</label><input id="cEnd">
<label><input type="checkbox" id="cAllow"> Admit Allowed</label>
<button class="approve" onclick="saveAdmit()">Save Admit</button>
</div>

<div class="section">
<b>Result</b>
<label>Marks</label><input id="rMarks">
<label>Rank</label><input id="rRank">
<label>Status</label><input id="rStatus">
<label><input type="checkbox" id="rPub"> Publish</label>
<button class="approve" onclick="saveResult()">Save Result</button>
</div>

<p class="msg" id="dMsg"></p>
</div>

</div>

<script>
/* ================= SUPABASE (FIXED) ================= */
const sb = supabase.createClient(
 "https://iqcbgiwycbuyvpxegmfg.supabase.co",
 "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlxY2JnaXd5Y2J1eXZweGVnbWZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5NDQ4MDYsImV4cCI6MjA4MzUyMDgwNn0.WfFbOZw2ZRRX9bWxQ0HMUqskAfIL4MvoyAENFPPatjM"
);

let currentId = null;

/* PUBLIC URL */
function pub(path){
 if(!path) return null;
 const { data } = sb.storage.from("student_docs").getPublicUrl(path);
 return data?.publicUrl || null;
}

/* LOAD TABLE */
async function load(){
 const { data, error } = await sb
  .from("students")
  .select("*")
  .order("created_at",{ascending:false});

 if(error){ listMsg.innerText=error.message; return; }

 tbody.innerHTML="";
 let i=1;

 data.forEach(s=>{
  const tr=document.createElement("tr");
  tr.innerHTML=`
   <td>${i++}</td>
   <td>${s.roll_number||""}</td>
   <td>${s.full_name||""}</td>
   <td>${s.mobile||""}</td>
   <td>${s.exam_level||""}</td>
   <td>${s.form_status||"pending"}</td>
   <td>${s.payment_status||"pending"}</td>
   <td>
    <button class="view">View</button>
    <button class="edit">Edit Name</button>
    <button class="del">Delete</button>
   </td>`;

  tr.querySelector(".view").onclick=()=>openDetail(s);
  tr.querySelector(".edit").onclick=()=>editName(s.id,s.full_name);
  tr.querySelector(".del").onclick=()=>delRow(s.id);
  tbody.appendChild(tr);
 });

 listMsg.innerText="Loaded";
}
load();

/* बाकी code 100% SAME है — कोई बदलाव नहीं */
</script>

</body>
</html>

